!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.naviBoard=e():t.naviBoard=e()}(window,function(){return function(t){var e={};function i(r){if(e[r])return e[r].exports;var n=e[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,r){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(r,n,function(e){return t[e]}.bind(null,n));return r},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=1)}([function(t,e){function i(t){return function(t){if(Array.isArray(t)){for(var e=0,i=new Array(t.length);e<t.length;e++)i[e]=t[e];return i}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}var r=window;function n(){this.currentEvent=null,this.componentRendered=null,this.matrixForNavigation=null,this.currentX=0,this.currentY=0,this.activeElement=null,this.prevComponentRendered=[],this.prevActiveElement=[],this.nextComponentRendered=null,this.arrayOfCoordinates=[],this.initialOffsetX=0,this.initialOffsetY=0,this.resume=!0,this.matrixWidth=0,this.matrixHeight=0}n.prototype._getLocationOfActiveElement=function(t){if(null!=this.matrixForNavigation)for(var e=0;e<this.matrixForNavigation.length;e++)for(var i=0;i<this.matrixForNavigation[0].length;i++)if(this.matrixForNavigation[e][i]==t)return[e,i];return[0,0]},n.prototype.getWindowRelativeOffset=function(t){return t.getBoundingClientRect()},n.prototype.makeNavigationRulesForComponent=function(t,e,r){var n=this,a=this,o=JSON.parse(JSON.stringify(function t(e){var i=new Array(e||0),r=e;if(arguments.length>1)for(var n=Array.prototype.slice.call(arguments,1);r--;)i[e-1-r]=t.apply(this,n);return i}(e,r)));new Promise(function(a,s){var h=n.matrixWidth/r,u=n.matrixHeight/e;a(function(t,e,i,r){var n=Array.from(Object.create(e)),a=t;function o(t,e,i,r,n,a){for(var o=0;o<a;o++)for(var s=0;s<n;s++)t[i+o][r+s]=e}if(void 0!=a&&a!=[])for(var s=0;s<a.length;s++)for(var h=0;h<a[s].length;h++){if(null!=a[s][h])var u=Math.round(a[s][h].offset.width/i),c=Math.round(a[s][h].offset.height/r);null!==a[s][h]&&(u>1||c>1)?o(n,a[s][h].elementToFocus,s,h,u,c):null!==a[s][h]&&(n[s][h]=a[s][h].elementToFocus)}return n}(function(t){for(var e=0;e<t.length;e++){var r=t.length*t[e].offset.x+t[e].offset.y;t[e].iValue=r}t.sort(function(t,e){var i=t.offset.y,r=e.offset.y;return i<r?-1:i>r?1:0});var n=[],a=[],o=!1;for(e=0;e<t.length;e++)o?t[e].offset.y>a[a.length-1].offset.y&&e!=t.length-1?(n.push(a),(a=[]).push(t[e])):e===t.length-1?t[e].offset.y>a[a.length-1].offset.y?(n.push(a),(a=[]).push(t[e]),n.push(a)):(a.push(t[e]),n.push(a)):a.push(t[e]):(a.push(t[e]),o=!0);a.length>0&&0==n.length&&n.push(a);for(var s=0;s<n.length;s++)n[s].sort(function(t,e){var i=t.offset.x,r=e.offset.x;return i<r?-1:i>r?1:0});var h=i(new Set(n.reduce(function(t,e){return t.concat(e.map(function(t){return t.offset.x}))},[]))).sort(function(t,e){return t-e});return n.forEach(function(t){h.forEach(function(e,i){(void 0===t[i]||t[i].offset.x>e)&&t.splice(i,0,null)})}),n}(t),o,h,u)),s(err)}).then(function(t){if(a.matrixForNavigation=t,0!=a.matrixForNavigation.length&&void 0!=a.matrixForNavigation){var e=!1;if(a.prevComponentRendered.length>=2&&a.prevActiveElement.length>=2&&a.prevComponentRendered[a.prevComponentRendered.length-2]==a.nextComponentRendered&&null!=a.prevComponentRendered[a.prevComponentRendered.length-2]&&null!=a.nextComponentRendered){var i=a.prevActiveElement[a.prevActiveElement.length-2];a.currentX=i[0],a.currentY=i[1],e=!0}if(a.matrixForNavigation.length<a.currentX&&a.matrixForNavigation[0].length<a.currentY){for(var r=0;r<a.matrixForNavigation[0].length;r++)if(null!=a.matrixForNavigation[0][r]){a.currentX=0,a.currentY=r,a.activeElement=a.matrixForNavigation[a.currentX][a.currentY],a.activeElement.focus();break}}else if(a.matrixForNavigation.length>a.currentX&&a.matrixForNavigation[0].length>a.currentY&&e)a.activeElement=a.matrixForNavigation[a.currentX][a.currentY],a.activeElement.focus();else if(a.matrixForNavigation.length>a.currentX&&a.matrixForNavigation[0].length>a.currentY){for(r=0;r<a.matrixForNavigation[0].length;r++)if(null!=a.matrixForNavigation[0][r]){a.currentX=0,a.currentY=r,a.activeElement=a.matrixForNavigation[a.currentX][a.currentY],a.activeElement.focus();break}}else for(r=0;r<a.matrixForNavigation[0].length;r++)if(null!=a.matrixForNavigation[0][r]){a.currentX=0,a.currentY=r,a.activeElement=a.matrixForNavigation[a.currentX][a.currentY],a.activeElement.focus();break}}},function(t){console.log(t)})};var a=(new Date).getTime();n.prototype.destroyCurrentNavigationView=function(t,e){var i=(new Date).getTime();return i-a<250?(a=i,!1):"destroy"==e?(this.prevComponentRendered.push(this.componentRendered),this.prevComponentRendered.length>=5&&(this.prevComponentRendered=this.prevComponentRendered.slice(Math.max(this.prevComponentRendered.length-5,2))),this.prevActiveElement.push(this._getLocationOfActiveElement(this.activeElement)),this.prevActiveElement.length>=5&&(this.prevActiveElement=this.prevActiveElement.slice(Math.max(this.prevActiveElement.length-5,2))),this.arrayOfCoordinates=[],o=[],s=[],this.initialOffsetX=0,this.initialOffsetY=0,this.matrixForNavigation=null,this.currentX=0,this.currentY=0,this.activeElement=null,this.currentEvent=null,this.componentRendered=null,a=i,!0):(o=[],s=[],this.arrayOfCoordinates=[],this.initialOffsetX=0,this.initialOffsetY=0,this.matrixForNavigation=null,this.currentX=0,this.currentY=0,this.activeElement=null,this.currentEvent=null,a=i,!0)};var o=[],s=[];function h(t){for(var e=t[0].offset.left,i=t[0].offset.right,r=t[0].offset.top,n=t[0].offset.bottom,a=1,o=t.length;a<o;a++){var s=t[a].offset.left,h=t[a].offset.top,u=t[a].offset.right,c=t[a].offset.bottom;e=s<e?s:e,r=h<r?h:r,i=u>i?u:i,n=c>n?c:n}return[i-e,n-r]}n.prototype.increaseRowCountIfRequired=function(t,e){return t.y=Math.round(t.y),t.y>this.initialOffsetY&&t.y>Math.max.apply(Math,i(s))?(this.initialOffsetY=t.y,s.push(t.y),e+1):t.y<this.initialOffsetY&&!s.includes(t.y)?(this.initialOffsetY=t.y,s.push(t.y),e+1):e},n.prototype.increaseColumnCountIfRequired=function(t,e){return t.x=Math.round(t.x),t.x>this.initialOffsetX&&t.x>Math.max.apply(Math,i(o))?(this.initialOffsetX=t.x,o.push(t.x),e+1):t.x<this.initialOffsetX&&!o.includes(t.x)?(this.initialOffsetX=t.x,o.push(t.x),e+1):e},n.prototype.handleView=function(t){var e=this;e.arrayOfCoordinates=[],e.componentRendered=t;new Promise(function(e,i){r=document.getElementById(t),e(r.getElementsByClassName("navigable")),i(err)}).then(function(t){for(var i=0,r=0,n=0;n<t.length;n++){t[n].tabIndex=-1===t[n].tabIndex?0:t[n].tabIndex;var a=e.getWindowRelativeOffset(t[n]);i=e.increaseRowCountIfRequired(a,i),r=e.increaseColumnCountIfRequired(a,r);var o={offset:a,elementToFocus:t[n]};e.arrayOfCoordinates.push(o)}e.matrixWidth=h(e.arrayOfCoordinates)[0],e.matrixHeight=h(e.arrayOfCoordinates)[1],e.makeNavigationRulesForComponent(e.arrayOfCoordinates,i,r)},function(t){console.log(t)})};var u=new n;u.getActiveElement=function(){return this.activeElement},u.setNavigation=function(t){null===this.matrixForNavigation&&(this.nextComponentRendered=t,this.handleView(t))},u.destroyNavigation=function(t){this.destroyCurrentNavigationView(t,"destroy")},u.getCurrentEvent=function(t){return this.currentEvent},u.refreshNavigation=function(t,e){if("refresh"==e){this.prevComponentRendered.push(this.componentRendered),this.prevActiveElement.push(this._getLocationOfActiveElement(activeElement)),this.destroyCurrentNavigationView(t,"destroy")&&this.handleView(t)}else{this.destroyCurrentNavigationView(t,e)&&this.handleView(t)}},u.getNavigationComponent=function(){return this.componentRendered},u.resumeNavigation=function(){this.resume=!0},u.pauseNavigation=function(){this.resume=!1};var c=function(t){if(null!==this.matrixForNavigation&&this.resume){var e=this.matrixForNavigation.length,i=this.matrixForNavigation[0].length,r=function(){for(var t=arguments[1];t>=0;){if(void 0!==this.matrixForNavigation[arguments[0]][t]&&null!==this.matrixForNavigation[arguments[0]][t])return this.activeElement.blur(),this.currentX=arguments[0],this.currentY=t,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus(),!0;t--}return!1}.bind(this),n=function(){for(var t=arguments[1];t<i;){if(void 0!==this.matrixForNavigation[arguments[0]][t]&&null!==this.matrixForNavigation[arguments[0]][t])return this.activeElement.blur(),this.currentX=arguments[0],this.currentY=t,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus(),!0;t++}return!1}.bind(this),a=function(){for(var t=arguments[0];t>=0;){if(void 0!==this.matrixForNavigation[t][arguments[1]]&&null!==this.matrixForNavigation[t][arguments[1]])return this.activeElement.blur(),this.currentY=arguments[1],this.currentX=t,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus(),!0;t--}return!1}.bind(this),o=function(){for(var t=arguments[0];t<e;){if(void 0!==this.matrixForNavigation[t][arguments[1]]&&null!==this.matrixForNavigation[t][arguments[1]])return this.activeElement.blur(),this.currentY=arguments[1],this.currentX=t,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus(),!0;t++}return!1}.bind(this);if(null!=this.matrixForNavigation&&0!=this.matrixForNavigation.length)if(this.currentEvent=t,40==t.keyCode){if(this.currentX+1>=e);else if(void 0!=this.matrixForNavigation[this.currentX+1][this.currentY]&&this.matrixForNavigation[this.currentX+1][this.currentY]!=this.activeElement)this.activeElement.blur(),this.currentX=this.currentX+1,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus();else if(void 0!==this.matrixForNavigation[this.currentX+1][this.currentY]&&this.matrixForNavigation[this.currentX+1][this.currentY]!=this.activeElement&&null===this.matrixForNavigation[this.currentX+1][this.currentY]){for(var s=this.currentX+1,h=!1;s<e;){if(null!=this.matrixForNavigation[s][this.currentY]){this.activeElement.blur(),this.currentX=s,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus(),h=!0;break}s++}if(this.currentY>=0&&!h)0==r(this.currentX+1,this.currentY)&&n(this.currentX+1,this.currentY)}else if(this.matrixForNavigation[this.currentX+1][this.currentY]===this.activeElement)for(s=this.currentX+1;s<e;){if(this.matrixForNavigation[s][this.currentY]!=this.activeElement){this.activeElement.blur(),this.currentX=s,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus();break}s++}}else if(38==t.keyCode){if(this.currentX-1<0);else if(void 0!=this.matrixForNavigation[this.currentX-1][this.currentY]&&this.matrixForNavigation[this.currentX-1][this.currentY]!=this.activeElement)this.activeElement.blur(),this.currentX=this.currentX-1,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus();else if(void 0!==this.matrixForNavigation[this.currentX-1][this.currentY]&&this.matrixForNavigation[this.currentX-1][this.currentY]!=this.activeElement&&null===this.matrixForNavigation[this.currentX-1][this.currentY]){var u=this.currentX-1;for(h=!1;u>=0;){if(null!=this.matrixForNavigation[u][this.currentY]){this.activeElement.blur(),this.currentX=u,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus(),h=!0;break}u--}if(this.currentY>0&&!h)0==r(this.currentX-1,this.currentY)&&n(this.currentX-1,this.currentY)}else if(this.matrixForNavigation[this.currentX-1][this.currentY]===this.activeElement)for(u=this.currentX-1;u>=0;){if(this.matrixForNavigation[u][this.currentY]!=this.activeElement){this.activeElement.blur(),this.currentX=u,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus();break}u--}}else if(39==t.keyCode){if(this.currentY+1>=i);else if(void 0!=this.matrixForNavigation[this.currentX][this.currentY+1]&&this.matrixForNavigation[this.currentX][this.currentY+1]!=this.activeElement)this.activeElement.blur(),this.currentY=this.currentY+1,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus();else if(void 0!==this.matrixForNavigation[this.currentX][this.currentY+1]&&this.matrixForNavigation[this.currentX][this.currentY+1]!=this.activeElement&&null===this.matrixForNavigation[this.currentX][this.currentY+1]){h=!1;for(var c=this.currentY+1;c<i;){if(null!=this.matrixForNavigation[this.currentX][c]){this.activeElement.blur(),this.currentY=c,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus(),h=!0;break}c++}if(this.currentY>0&&!h)0==a(this.currentX,this.currentY+1)&&o(this.currentX,this.currentY+1)}else if(this.matrixForNavigation[this.currentX][this.currentY+1]===this.activeElement)for(c=this.currentY+1;c<i;){if(this.matrixForNavigation[this.currentX][c]!=this.activeElement){this.activeElement.blur(),this.currentY=c,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus();break}c++}}else if(37==t.keyCode)if(this.currentY-1<0);else if(void 0!=this.matrixForNavigation[this.currentX][this.currentY-1]&&this.matrixForNavigation[this.currentX][this.currentY-1]!=this.activeElement)this.activeElement.blur(),this.currentY=this.currentY-1,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus();else if(void 0!==this.matrixForNavigation[this.currentX][this.currentY-1]&&this.matrixForNavigation[this.currentX][this.currentY-1]!=this.activeElement&&null===this.matrixForNavigation[this.currentX][this.currentY-1]){var l=this.currentY-1;for(h=!1;l>=0;){if(null!=this.matrixForNavigation[this.currentX][l]){this.activeElement.blur(),this.currentY=l,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus(),h=!0;break}l--}if(this.currentX>0&&!h)0==a(this.currentX,this.currentY-1)&&o(this.currentX,this.currentY-1)}else if(this.matrixForNavigation[this.currentX][this.currentY-1]===this.activeElement)for(l=this.currentY-1;l>=0;){if(this.matrixForNavigation[this.currentX][l]!=this.activeElement){this.activeElement.blur(),this.currentY=l,this.activeElement=this.matrixForNavigation[this.currentX][this.currentY],this.activeElement.focus();break}l--}}else console.log("Navigation is paused")}.bind(u);r.addEventListener("keydown",c,!0),t.exports=u},function(t,e,i){var r=i(0);t.exports=r}])});